<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PosterMaker - 海报制作器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, select, textarea {
            width: 100%;
            padding: 5px;
        }
        button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>PosterMaker - 海报制作器</h1>

    <form id="posterForm">
        <div class="form-group">
            <label for="text">文本内容：</label>
            <textarea id="text" name="text" rows="4">默认文本</textarea>
        </div>

        <div class="form-group">
            <label for="fontSize">字体大小：</label>
            <input type="number" id="fontSize" name="fontSize" value="30">
        </div>

        <div class="form-group">
            <label for="fontColor">字体颜色：</label>
            <input type="color" id="fontColor" name="fontColor" value="#000000">
        </div>

        <div class="form-group">
            <label for="fontFamily">字体：</label>
            <select id="fontFamily" name="fontFamily">
                <option value="mingchao">明朝体</option>
                <option value="siyuansong">思源宋</option>
                <option value="EVA">EVA明朝体</option>
            </select>
        </div>

        <div class="form-group">
            <label for="textAlign">对齐方式：</label>
            <select id="textAlign" name="textAlign">
                <option value="start">左对齐</option>
                <option value="middle">居中</option>
                <option value="end">右对齐</option>
            </select>
        </div>

        <div class="form-group">
            <label for="lineHeight">行高：</label>
            <input type="number" id="lineHeight" name="lineHeight" value="1.2" step="0.1">
        </div>

        <div class="form-group">
            <label for="bgType">背景类型：</label>
            <select id="bgType" name="bgType">
                <option value="color">纯色</option>
                <option value="gradient">渐变</option>
            </select>
        </div>

        <div id="bgColorGroup" class="form-group">
            <label for="bgColor">背景颜色：</label>
            <input type="color" id="bgColor" name="bgColor" value="#f0f0f0">
        </div>

        <div id="gradientColors" class="form-group" style="display:none;">
            <label for="gradientColor1">渐变色1：</label>
            <input type="color" id="gradientColor1" name="gradientColor1" value="#ffffff">
            <label for="gradientColor2">渐变色2：</label>
            <input type="color" id="gradientColor2" name="gradientColor2" value="#a0a0a0">
            <label for="gradientColor3">渐变色3：</label>
            <input type="color" id="gradientColor3" name="gradientColor3" value="#f0f0f0">
        </div>

        <div class="form-group">
            <label for="size">图片尺寸：</label>
            <select id="size" name="size">
                <option value="500,300">默认 (500x300)</option>
                <option value="1080,1920">手机壁纸 (1080x1920)</option>
                <option value="1920,1080">电脑壁纸 (1920x1080)</option>
                <option value="1200,630">社交媒体封面 (1200x630)</option>
                <option value="800,800">Instagram 方形 (800x800)</option>
                <option value="1280,720">YouTube 缩略图 (1280x720)</option>
            </select>
        </div>

        <div class="form-group">
            <label for="effect">光影效果：</label>
            <select id="effect" name="effect">
                <option value="none">无</option>
                <option value="shadow">阴影</option>
                <option value="glow">光晕</option>
            </select>
        </div>

        <button type="submit">生成海报</button>
        <button type="reset">重置设置</button>
    </form>

    <div id="preview"></div>
    <a id="downloadLink" style="display:none;">下载PNG图片</a>

    <footer>
        <p>© 2024 PosterMaker | Made by Ming143 | <a id="projectLink" href="#">Project repository</a></p>
    </footer>

    <script>
        const form = document.getElementById('posterForm');
        const preview = document.getElementById('preview');
        const downloadLink = document.getElementById('downloadLink');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const params = new URLSearchParams(formData);
            const [width, height] = formData.get('size').split(',');
            params.set('width', width);
            params.set('height', height);
            
            if (formData.get('bgType') === 'gradient') {
                const gradient = `${formData.get('gradientColor1')},${formData.get('gradientColor2')},${formData.get('gradientColor3')}`;
                params.set('bgGradient', gradient);
            }

            try {
                const response = await fetch(`https://postermaker.ming143.eu.org/?${params.toString()}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const svgText = await response.text();

                preview.innerHTML = svgText;

                // Convert SVG to PNG
                const svgElement = preview.querySelector('svg');
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                const img = new Image();
                img.onload = () => {
                    ctx.drawImage(img, 0, 0);
                    downloadLink.href = canvas.toDataURL('image/png');
                    downloadLink.download = 'poster.png';
                    downloadLink.style.display = 'inline-block';
                };
                img.src = 'data:image/svg+xml;base64,' + btoa(svgText);
            } catch (error) {
                console.error('Error:', error);
                preview.textContent = `Error generating poster: ${error.message}`;
            }
        });

        document.getElementById('bgType').addEventListener('change', (e) => {
            const bgColorGroup = document.getElementById('bgColorGroup');
            const gradientColors = document.getElementById('gradientColors');
            if (e.target.value === 'gradient') {
                bgColorGroup.style.display = 'none';
                gradientColors.style.display = 'block';
            } else {
                bgColorGroup.style.display = 'block';
                gradientColors.style.display = 'none';
            }
        });
    </script>
</body>
</html>